# =====================================================
# Nginx Status Module Configuration
# Add this to your main nginx config for metrics
# =====================================================

# Add inside the server block:

# Nginx status endpoint for prometheus exporter
location /nginx_status {
    stub_status on;
    access_log off;
    allow 127.0.0.1;
    allow 172.16.0.0/12;  # Docker networks
    allow 10.0.0.0/8;      # Docker networks
    deny all;
}

# Grafana reverse proxy (optional)
location /grafana/ {
    proxy_pass http://grafana:3000/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# Prometheus reverse proxy (optional - restrict access!)
location /prometheus/ {
    # Restrict to internal networks only
    allow 127.0.0.1;
    allow 10.0.0.0/8;
    deny all;
    
    proxy_pass http://prometheus:9090/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
